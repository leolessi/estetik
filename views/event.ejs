<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Consultas</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- <link rel="stylesheet" href="calendar.css" /> -->
  </head>

  <body class="bg-light">
    <div
      class="container vh-100 d-flex justify-content-center align-items-center"
    >
      <div class="card shadow-lg p-4 w-100" style="max-width: 500px">
        <h1 class="text-center mb-1 mt-1"><%= appo.name %> <br /></h1>
        <h2 class="text-center mb-1 mt-1">Serviço: <%= appo.serviceType %></h2>
        <% if (appo.description != "") { %>
        <h2 class="text-center mb-1 mt-1">Obs: <%= appo.description %></h2>
        <% } %>
        <hr />
        <!-- prettier-ignore -->
        <h3>
          Dia:
          <span class="text-dark"
            ><%= (() => { try { let date = new Date(appo.date); if (isNaN(date))
            throw new Error("Data inválida"); date.setHours(date.getHours() +
            3); let dayOfWeek = date.toLocaleDateString("pt-BR", { weekday:
            'long' }); let numericDate = date.toLocaleDateString("pt-BR");
            return `${numericDate} | ${dayOfWeek}`; } catch (error) { return
            "Data inválida"; } })() %></span
          >
        </h3>
        <h3>Horário: <%= appo.time %></h3>
        <h3>Email: <%= appo.email %></h3>
        <h3>Celular: <%= appo.phone %></h3>
        <hr />
        <h5 class="text-secondary">
          Agendado por:
          <span class="text-dark"><%= appo.createdBy || "Desconhecido" %></span>
        </h5>
        <hr />
        <% if (!appo.finished) { %>
        <form id="finishForm-<%= appo._id %>" action="/finish" method="post">
          <input type="hidden" name="id" value="<%= appo._id %>" />
          <button
            type="button"
            class="btn btn-success w-100"
            onclick="confirmFinish('<%= appo._id %>')"
          >
            Finalizar consulta
          </button>
        </form>
        <% } %>
        <div>
          <a href="/update/<%= appo._id %>" class="btn btn-primary w-100 mt-1"
            >Editar</a
          >
        </div>
        <a href="/" class="btn btn-secondary w-100 mt-1">Voltar</a>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function confirmFinish(appoId) {
        const confirmation = confirm(
          "Você realmente deseja finalizar esta consulta?"
        );
        if (confirmation) {
          document.getElementById(`finishForm-${appoId}`).submit();
        } else {
          window.location.reload();
        }
      }
    </script>
  </body>
</html>
